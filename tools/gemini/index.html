<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>üßø CustomGemini</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>
<body>

  <div id="navbar"></div>

  <div class="container mb-3 text-center">
    <div class="container-fluid mb-3 text-center">
      <h1>üßøCustomGemini</h1>
      <h5>Customized Google Gemini Pro LLM</h5>
    </div>

    <div class="dropdown-center mb-3">
      <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        API ‚öôÔ∏è
      </button>
      <ul class="dropdown-menu mb-2 text-center">
        <li><button type="button" class="btn btn-outline-primary mb-2" onclick="openModal()" data-bs-toggle="tooltip" title="Save API key to cookies">Add</button></li>
        <li><a href="https://aistudio.google.com/app/apikey" class="btn btn-outline-info mb-2" onclick="getKeys()" target="_blank" data-bs-toggle="tooltip" title="Get API keys from google">Get Keys</a></li>
        <li><button type="button" class="btn btn-outline-success mb-2" onclick="showSavedApiKey()" data-bs-toggle="tooltip" title="Your API key is securely stored in your local browser's cookie and is never transmitted to the cloud.">Show saved key</button></li>
        <li><button type="button" class="btn btn-outline-danger mb-2" onclick="showConfirmationModal()" data-bs-toggle="tooltip" title="Clear API key from cookies">Clear</button></li>
      </ul>
    </div>
    

  <div class="container mb-3 text-center">
      <div class="input-group mb-3">
          <input type="text" class="form-control" id="chat-input" placeholder="Type your message..." aria-label="Recipient's username" aria-describedby="button-addon2">
          <button class="btn btn-outline-secondary" type="button" id="send-btn">Send</button>
        </div>      
  </div>

  <div class="chat-container"></div>

  <!-- Loading indicator using Bootstrap -->
  <div class="container mb-2 text-center">
    <div id="loading-indicator" style="display: none;">
      <button class="btn btn-primary mb" type="button" disabled>
        <span class="spinner-grow spinner-grow-sm" aria-hidden="true"></span>
        <span role="status">Generating...</span>
      </button>
    </div>
  </div>

  <!-- Accordion -->
  <div class="accordion container mb-4" id="accordionExample" style="display: none;">
    <div class="accordion-item mb-2">
      <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
        <div class="accordion-body" id="result_latest">    
        </div>
      </div>
    </div>
    <div class="btn-group text-right mb-2" role="group" aria-label="Basic outlined example">
      <button type="button" onclick="copyText()" id="liveToastBtn" class="btn btn-outline-primary" data-bs-toggle="tooltip" title="Copy result">üìã</button>
    </div>
  </div>



  <div class="toast text-bg-primary position-fixed bottom-0 end-0 p-3" id="liveToast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        Result has been copied to clipboard.
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>




































  <div id="footer"></div>
  <div id="modals"></div>

    
</body>




<script>
  function openModal() {
    // Open the modal
    var myModal = new bootstrap.Modal(document.getElementById('saveApiKeyModal'));
    myModal.show();
  }

  function saveApiKey() {
    var apiKey = document.getElementById('apiKeyInput').value;
    document.cookie = "savedAPI=" + apiKey + "; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/";
    document.getElementById("apiKeyInput").value = "";
    showSavedApiKey()
    var myModal = bootstrap.Modal.getInstance(document.getElementById('saveApiKeyModal'));
    myModal.hide();
    // Reload the page
    location.reload();
  }

  function showSavedApiKey() {

  var savedApiKey = getSavedApiKeyFromCookies(); 

  
  document.getElementById('savedApiKeyDisplay').innerText = "Your API Key: " + savedApiKey;


  var myModal = new bootstrap.Modal(document.getElementById('savedApiKeyModal'));
  myModal.show();
  }

  function getSavedApiKeyFromCookies() {
      var cookies = document.cookie.split(';');
      for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.startsWith("savedAPI=")) {
              var savedAPI = cookie.substring("savedAPI=".length);
              return savedAPI; 
          }
      }
      return savedAPI = "No API key üö´";
  }



</script>

<script>
  function showConfirmationModal() {
      var confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
      confirmationModal.show();
  }

  function clearApiKey() {
      document.cookie = "savedAPI=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      var myModal = new bootstrap.Modal(document.getElementById('clearAPIdata'));
      myModal.show();
  }
</script>



<script>
  const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
  const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
</script>

<script src='../../src/components/navspace.js'></script>
<script>
  fetch('../../src/components/nav.html')
      .then(response => response.text())
      .then(data => {
          document.getElementById('navbar').innerHTML = data;
          displayRandomVariation();
      })
      .catch(error => {
          console.error('Error fetching navbar:', error);
      });
  </script>
  <script>
  fetch('../../src/components/footer.html')
      .then(response => response.text())
      .then(data => {
          document.getElementById('footer').innerHTML = data;
      })
      .catch(error => {
          console.error('Error fetching footer:', error);
      });
  </script>
  <script>
  fetch('../gemini/components/modal.html')
      .then(response => response.text())
      .then(data => {
          document.getElementById('modals').innerHTML = data;
      })
      .catch(error => {
          console.error('Error fetching modals:', error);
      });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
  </script>

<script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";

    // Fetch your API_KEY
    var savedApiKey = getSavedApiKeyFromCookies();
    const API_KEY = savedApiKey;

    // Access your API key (see "Set up your API key" above)
    const genAI = new GoogleGenerativeAI(API_KEY);

    async function generateStory(prompt) {
        
        const model = genAI.getGenerativeModel({ model: "gemini-pro" });

        const result = await model.generateContent(prompt);
        const response = await result.response;
        const text = response.text();
        return text;
    }

    document.getElementById("send-btn").addEventListener("click", async () => {
        const prompt = document.getElementById("chat-input").value;

        // Show loading indicator
        document.getElementById("loading-indicator").style.display = 'block';

  
        const resultText = await generateStory(prompt);
        console.log(resultText);

        // Hide loading indicator
        document.getElementById("loading-indicator").style.display = 'none';

 
        console.log(resultText);
        // Display the result within the accordion container
        const resultContainer = document.getElementById("result_latest");
        accordionExample.style.display = 'block';
        // Convert Markdown to HTML
        const htmlResult = marked.parse(resultText);

        // Update the content of resultContainer with HTML
        resultContainer.innerHTML = htmlResult;
    });
</script>



<script>
  // Initialize the toast instance
  const toastLiveExample = document.getElementById('liveToast');
  const toastBootstrap = new bootstrap.Toast(toastLiveExample);

  function copyText() {
    var textToCopy = document.getElementById("result_latest").innerText;
    var textarea = document.createElement("textarea");
    textarea.value = textToCopy;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);

    // Show the toast
    toastBootstrap.show();
  }
</script>

</html>
